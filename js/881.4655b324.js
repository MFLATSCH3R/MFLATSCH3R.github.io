"use strict";(globalThis["webpackChunklocate_it"]=globalThis["webpackChunklocate_it"]||[]).push([[881],{1881:(t,o,e)=>{e.r(o),e.d(o,{default:()=>et});var i=e(9835);function a(t,o,e,a,n,s){const l=(0,i.up)("CustomMap"),r=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(r,{class:"flex flex-center",padding:""},{default:(0,i.w5)((()=>[(0,i.Wm)(l)])),_:1})}var n=e(6970);const s=t=>((0,i.dD)("data-v-78dd2aed"),t=t(),(0,i.Cn)(),t),l={id:"map",ref:"map-container"},r=s((()=>(0,i._)("div",{class:"row no-wrap items-center"},[(0,i._)("div",{class:"col text-h6 ellipsis"},"New Finding")],-1))),c={class:"text-subtitle1"},d=(0,i.Uk)(" No Results "),p={class:"text-caption text-grey"},m=(0,i.Uk)("Close"),g=(0,i.Uk)("Save");function h(t,o,e,a,s,h){const u=(0,i.up)("q-btn"),w=(0,i.up)("q-btn-group"),y=(0,i.up)("q-img"),f=(0,i.up)("q-card-section"),Z=(0,i.up)("q-item-section"),v=(0,i.up)("q-item"),S=(0,i.up)("q-select"),_=(0,i.up)("q-separator"),x=(0,i.up)("q-card-actions"),L=(0,i.up)("q-card"),P=(0,i.up)("q-dialog");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",l,null,512),(0,i.Wm)(w,{rounded:"",style:{position:"absolute",bottom:"0px"},class:"q-mb-sm"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{color:"primary",rounded:"",icon:"remove",onClick:h.zoomOut,size:"lg"},null,8,["onClick"]),(0,i.Wm)(u,{color:"primary",round:"",icon:"my_location",size:"lg",onClick:h.animateToLocation},null,8,["onClick"]),(0,i.Wm)(u,{color:"primary",rounded:"",icon:"add",onClick:h.zoomIn,size:"lg"},null,8,["onClick"])])),_:1}),(0,i.Wm)(P,{modelValue:s.isDialogOpen,"onUpdate:modelValue":o[2]||(o[2]=t=>s.isDialogOpen=t),maximized:""},{default:(0,i.w5)((()=>[(0,i.Wm)(L,{class:"my-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:this.imgSrc},null,8,["src"]),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{fab:"",color:"primary",icon:"place",class:"absolute",style:{top:"0",right:"12px",transform:"translateY(-50%)"}}),r])),_:1}),(0,i.Wm)(f,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i._)("div",c,[(0,i.Wm)(S,{filled:"",modelValue:s.finding,"onUpdate:modelValue":o[0]||(o[0]=t=>s.finding=t),"use-input":"","hide-selected":"","fill-input":"",options:s.options,style:{width:"300px"}},{"no-option":(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{class:"text-grey"},{default:(0,i.w5)((()=>[d])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),(0,i._)("div",p,(0,n.zw)(s.display_x)+" / "+(0,n.zw)(s.display_y),1)])),_:1}),(0,i.Wm)(_),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{flat:"",round:"",icon:"event"}),(0,i.Wm)(u,{flat:"",color:"primary",onClick:o[1]||(o[1]=t=>s.isDialogOpen=!1)},{default:(0,i.w5)((()=>[m])),_:1}),(0,i.Wm)(u,{flat:"",color:"primary",onClick:h.saveEntry},{default:(0,i.w5)((()=>[g])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var u=e(9387);const w=new u.ZP("appDB");w.version(1).stores({findings:"++id, type, x, y, description, timestamp"});var y=e(2852),f=e(9302),Z=e(6281),v=e(520),S=e(3769),_=e(6738),x=e(3672),L=e(7099),P=e(7970),k=e(8723),C=e(5695),M=e(3038),T=e(3410),W=e(5335),z=e(7617);e(2167);const b={name:"CustomMap",data(){return{animationMode:"pan",leftDrawerOpen:!1,isDialogOpen:!1,isEntriesOpen:!1,imgSrc:null,x:"",y:"",display_x:"",display_y:"",options:["Steinpilz","Pfifferling"],finding:null,findings:[]}},setup(){const t=(0,f.Z)();t.loading.show()},mounted(){this.prepareMap()},methods:{prepareMap(){this.getLocation(this.showMap,this.showMap)},showMap(t,o,e){this.$q.loading.hide(),this.map=new Z.Z({target:this.$refs["map-container"],layers:[new S.Z({source:new _.Z})],view:new v.ZP({zoom:e,center:(0,x.vs)([t,o],"EPSG:4326","EPSG:3857")}),controls:[]}),this.addLayers(),this.addMapEvents(),this.getAllFindings()},addLayers(){this.locationMarker=new W.Z({geometry:new z.Z({coordninates:[null,null]})});let t=new L.Z({source:new P.Z,style:new k.ZP({image:new C.Z({radius:24,fill:new M.Z({color:"rgba(156,39,176,0.4)"}),stroke:new T.Z({color:"rgb(156,39,176)",width:2})})})});t.getSource().addFeature(this.locationMarker),this.map.addLayer(t),this.findingsLayer=new L.Z({source:new P.Z,style:new k.ZP({image:new C.Z({radius:12,fill:new M.Z({color:"rgba(156,176,39,0.6)"}),stroke:new T.Z({color:"rgba(55,55,55,0.7)",width:2})})})}),this.map.addLayer(this.findingsLayer)},addMapEvents(){this.addLongTapEvent(this.onMapTap)},addLongTapEvent(t){this.startTime=null,this.endTime=null,this.longpress=!1,this.map.on("click",(o=>{this.longpress&&t(o)})),this.map.on("pointerdown",(t=>{this.startTime=(new Date).getTime()})),this.map.on("pointerup",(t=>{this.endTime=(new Date).getTime(),this.longpress=!(this.endTime-this.startTime<500)}))},onMapTap(t){this.goToPosition({x:t.coordinate[0],y:t.coordinate[1],z:17,proj:"EPSG:3857",onAnimationComplete:this.openNewFindingDialog}),this.isDialogOpen=!0},getLocation(t,o){navigator.geolocation?navigator.geolocation.getCurrentPosition((o=>{t(o.coords.longitude,o.coords.latitude,12)}),(t=>{o(0,0,2)}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):this.showMap(0,0,2)},animateToLocation(){this.getLocation(this.goToPosWGS84)},toggleLocationFollowing(){this.watchID?(this.unwatchLocation(),this.showNotification("Location following disabled")):(this.watchLocation(),this.showNotification("Location following enabled"))},watchLocation(){navigator.geolocation&&(this.watchID=navigator.geolocation.watchPosition(this.goToPosWGS84))},unwatchLocation(){navigator.geolocation&&navigator.geolocation.clearWatch(this.watchID)},goToPosWGS84(t,o){this.goToPosition({x:t,y:o,z:this.map.getView().getZoom(),proj:"EPSG:4326"})},updateLocationMarker(t){this.locationMarker.getGeometry().setCoordinates(t)},zoomIn(){this.map.getView().getZoom()<20&&this.map.getView().animate({zoom:this.map.getView().getZoom()+1,duration:250})},zoomOut(){this.map.getView().animate({zoom:this.map.getView().getZoom()-1,duration:250})},goToPosition(t){let o=(0,x.vs)([t.x,t.y],t.proj,"EPSG:3857"),e=this.map.getView().getZoom(),i=(0,x.vs)([t.x,t.y],t.proj,"EPSG:4326");this.x=i[0],this.y=i[1],this.display_x=Math.floor(1e3*i[0])/1e3,this.display_y=Math.floor(1e3*i[1])/1e3,t.z&&(e=t.z),t.onAnimationComplete?this.map.getView().animate({center:o,zoom:e,duration:500},t.onAnimationComplete):this.map.getView().animate({center:o,zoom:e,duration:500}),this.updateLocationMarker(o)},showNotification(t){this.$q.notify({message:t,color:"secondary"})},openNewFindingDialog(){this.getMapScreenshot()},async getMapScreenshot(){const t=await y.Z.getScreenshot(this.map,{dim:[300,200],scaleBarLength:100});this.imgSrc=t.img},async saveEntry(){try{const t=await w.findings.add({type:"Steinpilz",x:this.x,y:this.y,description:"",timestamp:(new Date).getTime()});let o=new W.Z({geometry:new z.Z((0,x.vs)([this.x,this.y],"EPSG:4326","EPSG:3857")),id:t});this.findingsLayer.getSource().addFeature(o),this.isDialogOpen=!1,this.showNotification("Entry added")}catch(t){console.warn(t)}},async getAllFindings(){this.list=await w.findings.toArray(),this.list.forEach((t=>{let o=new W.Z({geometry:new z.Z((0,x.vs)([t.x,t.y],"EPSG:4326","EPSG:3857")),id:t.id});this.findingsLayer.getSource().addFeature(o)}))}}};var D=e(1639),E=e(7236),q=e(4455),Q=e(2074),G=e(4458),V=e(335),A=e(3190),O=e(6673),F=e(490),I=e(1233),N=e(926),j=e(1821),B=e(4526),U=e(136),$=e(3246),H=e(1357),Y=e(9984),R=e.n(Y);const J=(0,D.Z)(b,[["render",h],["__scopeId","data-v-78dd2aed"]]),K=J;R()(b,"components",{QBtnGroup:E.Z,QBtn:q.Z,QDialog:Q.Z,QCard:G.Z,QImg:V.Z,QCardSection:A.Z,QSelect:O.Z,QItem:F.Z,QItemSection:I.Z,QSeparator:N.Z,QCardActions:j.Z,QBar:B.Z,QSpace:U.Z,QList:$.Z,QAvatar:H.Z});const X={name:"MapPage",components:{CustomMap:K}};var tt=e(9885);const ot=(0,D.Z)(X,[["render",a]]),et=ot;R()(X,"components",{QPage:tt.Z})}}]);